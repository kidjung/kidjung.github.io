I"­0
<hr />
<p>title:  â€œfacebookgo/injectë¥¼ ì´ìš©í•˜ì—¬ Golangì—ì„œì˜  DIë¥¼ í•´ë³´ìâ€</p>

<p>categories:</p>
<ul>
  <li>go
tags:</li>
  <li>[Go, Dev]</li>
</ul>

<p>toc: true
toc_sticky: true</p>

<p>date: 2021-09-28
last_modified_at: 2021-09-28
â€”</p>
<ul>
  <li>
    <p>ì˜ˆì‹œ í”„ë¡œì íŠ¸ ë‚´ìš©ì€ ì´í•´í•˜ê¸° ì‰½ê²Œ â€œê¹€ì˜í•œ ê°•ì‚¬ë‹˜ì˜ spring ê°•ì˜â€ì—ì„œ ì‚¬ìš©í–ˆë˜ ì˜ˆì œë¥¼ ì°¸ê³ í•˜ì—¬ ë§Œë“¤ì—ˆë‹¤.
Memberì •ë³´ë¥¼ ë“±ë¡í•˜ê³  Memberê°€ VIPì¸ì§€ í™•ì¸í•˜ì—¬ í• ì¸ ê¸ˆì•¡ì„ ì¶œë ¥í•  ìˆ˜ ìˆë„ë¡ í•˜ì˜€ë‹¤.</p>
  </li>
  <li>
    <p>ì˜ì¡´ì„± ì£¼ì…ì˜ ê²½ìš° Springì‚¬ìš©ì˜ ê²½í—˜ì´ ìˆì–´ ë¹—ëŒ€ì–´ì„œ ì´í•´í•˜ì˜€ë‹¤.</p>
  </li>
</ul>

<p>ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” config ë¶€ë¶„ê³¼ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë‚˜ëˆ ì„œ êµ¬í˜„í•˜ì—¬ì•¼ê² ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ì„¤ëª…ì„ ìœ„í•´ í•œ ì†ŒìŠ¤íŒŒì¼ì— ì„¤ì • ì£¼ì… ê³¼ ë¡œì§ ì‹¤í–‰ ëª¨ë‘ ë„£ì—ˆë‹¤.</p>

<h2 id="ê°-ê°ì²´ì˜-ì£¼ì…-ì„¤ì •-ë¶€ë¶„">ê° ê°ì²´ì˜ ì£¼ì… ì„¤ì • ë¶€ë¶„</h2>
<p>ì£¼ì…ì„ ë°›ê¸° ì›í•˜ëŠ” ê³³ì— `<code class="language-plaintext highlighter-rouge">inject:""</code>`ë¥¼ ë¶™ì—¬ì¤€ë‹¤</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">MemberServiceImpl</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">Repo</span> <span class="n">Repository</span> <span class="s">`inject:""`</span> <span class="c">// ì£¼ì… ë°›ê¸° ìœ„í•´ `inject:""` ë¶™ì„</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="ìœ ì €ë¥¼-ì €ì¥í•˜ëŠ”-ë ˆí¬ì§€í† ë¦¬">ìœ ì €ë¥¼ ì €ì¥í•˜ëŠ” ë ˆí¬ì§€í† ë¦¬</h2>
<p>ìœ ì €ë¥¼ ì €ì¥í•˜ëŠ” <code class="language-plaintext highlighter-rouge">Repository</code> ì¸í„°í˜ì´ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Repository</span> <span class="k">interface</span> <span class="p">{</span>
	<span class="n">Save</span><span class="p">(</span><span class="n">member</span> <span class="n">Member</span><span class="p">)</span><span class="s">`
	FindById(id int) Member
}
</span></code></pre></div></div>

<h2 id="ê°-êµ¬í˜„ì²´-ì˜ì¡´-ë¶€ë¶„">ê° êµ¬í˜„ì²´ ì˜ì¡´ ë¶€ë¶„</h2>

<p>ë©¤ë²„ë¥¼ ê´€ë¦¬í•˜ëŠ” <code class="language-plaintext highlighter-rouge">MemberService</code> ì¸í„°í˜ì´ìŠ¤ì™€ <code class="language-plaintext highlighter-rouge">MemberServiceImpl</code> êµ¬í˜„ì²´ì´ë‹¤.
ìœ ì €ë¥¼ ì €ì¥í•˜ëŠ” ë ˆí¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì£¼ì…ë°›ëŠ”ë‹¤.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">MemberService</span> <span class="k">interface</span> <span class="p">{</span>
	<span class="n">Join</span><span class="p">(</span><span class="n">member</span> <span class="n">Member</span><span class="p">)</span>
	<span class="n">FindMember</span><span class="p">(</span><span class="n">id</span> <span class="kt">int</span><span class="p">)</span> <span class="n">Member</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">MemberServiceImpl</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">Repo</span> <span class="n">Repository</span> <span class="s">`inject:""`</span>
<span class="p">}</span>
</code></pre></div></div>
<p>ì£¼ë¬¸ì„ ì²˜ë¦¬í•˜ëŠ” <code class="language-plaintext highlighter-rouge">OrderService</code> ì¸í„°í˜ì´ìŠ¤ì™€ <code class="language-plaintext highlighter-rouge">OrderServiceImpl</code> êµ¬í˜„ì²´ì´ë‹¤.
ìœ ì €ë¥¼ ì €ì¥í•˜ëŠ” ë ˆí¬ì§€í† ë¦¬ì™€ í• ì¸ ì •ì±…ì„ ê²°ì •í•˜ëŠ” DiscountPolicy ì¸í„°í˜ì´ìŠ¤ë¥¼ ì£¼ì…ë°›ëŠ”ë‹¤</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">OrderService</span> <span class="k">interface</span> <span class="p">{</span>
	<span class="n">CreateOrder</span><span class="p">(</span><span class="n">id</span> <span class="kt">int</span><span class="p">,</span> <span class="n">itemName</span> <span class="kt">string</span><span class="p">,</span> <span class="n">itemPrice</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="n">Order</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">OrderServiceImpl</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">Repository</span> <span class="n">Repository</span> <span class="s">`inject:""`</span>
	<span class="n">DisPolicy</span>  <span class="n">DiscountPolicy</span> <span class="s">`inject:""`</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="initgoì˜-run-ë¶€ë¶„">init.goì˜ Run() ë¶€ë¶„</h2>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">mini</span> <span class="n">MiniProject</span><span class="p">)</span> <span class="n">Run</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">member</span> <span class="o">:=</span> <span class="n">Member</span><span class="p">{</span><span class="m">1</span><span class="p">,</span><span class="s">"kj"</span><span class="p">,</span><span class="no">true</span><span class="p">}</span>

	<span class="c">// ê·¸ë˜í”„ ìƒì„± (ìŠ¤í”„ë§ì˜ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ì—­í•  ì¸ ë“¯ í•˜ë‹¤.)</span>
	<span class="k">var</span> <span class="n">graph</span> <span class="n">inject</span><span class="o">.</span><span class="n">Graph</span>

	<span class="c">// ê·¸ë˜í”„ì— ì˜¤ë¸Œì íŠ¸ ì œê³µ</span>
	<span class="n">err</span> <span class="o">:=</span> <span class="n">graph</span><span class="o">.</span><span class="n">Provide</span><span class="p">(</span>
		<span class="o">&amp;</span><span class="n">inject</span><span class="o">.</span><span class="n">Object</span><span class="p">{</span><span class="n">Value</span><span class="o">:</span> <span class="n">NewMemoryRepository</span><span class="p">()},</span>
     		<span class="o">&amp;</span><span class="n">inject</span><span class="o">.</span><span class="n">Object</span><span class="p">{</span><span class="n">Value</span><span class="o">:</span> <span class="n">NewMemberServiceImplWithNoArgs</span><span class="p">(),</span> <span class="n">Name</span><span class="o">:</span> <span class="s">"memberServiceImpl"</span><span class="p">},</span>
            	<span class="o">&amp;</span><span class="n">inject</span><span class="o">.</span><span class="n">Object</span><span class="p">{</span><span class="n">Value</span><span class="o">:</span> <span class="n">NewFixDiscountPolicy</span><span class="p">(</span><span class="m">1000</span><span class="p">)}),</span>
		<span class="o">&amp;</span><span class="n">inject</span><span class="o">.</span><span class="n">Object</span><span class="p">{</span><span class="n">Value</span><span class="o">:</span> <span class="n">NewOrderServiceImpl</span><span class="p">(),</span> <span class="n">Name</span><span class="o">:</span> <span class="s">"orderServiceImpl"</span><span class="p">}</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="c">// ì˜ì¡´ì„±ì„ ì£¼ì… ì‹¤í–‰ ë¶€ë¶„</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">Populate</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>
    
    
    
    	<span class="c">// ------------ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± ---------------</span>

	<span class="k">var</span> <span class="n">memberService</span> <span class="n">MemberService</span>
	<span class="k">var</span> <span class="n">orderService</span> <span class="n">OrderService</span>
    
	<span class="c">// ì˜ì¡´ì„± ìë™ ì£¼ì…ì´ ì™„ë£Œëœ êµ¬ì¡°ì²´ ì¸í„°í˜ì´ìŠ¤ì— ëŒ€ì… nameì„ ì´ìš©í•´ì„œ graphì—ì„œ ì‹±ê¸€í„´ ê°ì²´ë¥¼ êº¼ë‚´ì„œ ì‚¬ìš©</span>
	<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">obj</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">graph</span><span class="o">.</span><span class="n">Objects</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="s">"memberServiceImpl"</span> <span class="p">{</span>
			<span class="n">memberService</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Value</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="n">MemberServiceImpl</span><span class="p">)</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="s">"orderServiceImpl"</span> <span class="p">{</span>
			<span class="n">orderService</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Value</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="n">OrderServiceImpl</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">memberService</span><span class="o">.</span><span class="n">Join</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"ë©¤ë²„ ì°¾ê¸° ê²°ê³¼: "</span><span class="p">,</span><span class="n">memberService</span><span class="o">.</span><span class="n">FindMember</span><span class="p">(</span><span class="m">1</span><span class="p">))</span>

	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"ì£¼ë¬¸ ìƒì„± ê²°ê³¼: "</span> <span class="p">,</span><span class="n">orderService</span><span class="o">.</span><span class="n">CreateOrder</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="s">"Mac"</span><span class="p">,</span> <span class="m">100000</span><span class="p">))</span>

	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"ì˜ì¡´ì„± ê·¸ë˜í”„ ì¡´ì¬í•˜ëŠ” ëª¨ë“  ê°ì²´ ì¶œë ¥"</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">obj</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">graph</span><span class="o">.</span><span class="n">Objects</span><span class="p">()</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"object known: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
	<span class="p">}</span>
</code></pre></div></div>
<h2 id="ì‹¤í–‰ê²°ê³¼">ì‹¤í–‰ê²°ê³¼</h2>
<p>ì‹¤í–‰ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ê³  ì •ìƒì ìœ¼ë¡œ ì£¼ì…ì´ ë˜ì—ˆìŒì´ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ë©¤ë²„ ì°¾ê¸° ê²°ê³¼:  {1 kj true}
ì£¼ë¬¸ ìƒì„± ê²°ê³¼:  &amp;{1 Mac 100000 1000}
ì˜ì¡´ì„± ê·¸ë˜í”„ ì¡´ì¬í•˜ëŠ” ëª¨ë“  ê°ì²´ ì¶œë ¥
2021/08/03 16:07:15 object known: *modules.OrderServiceImpl named orderServiceImpl
2021/08/03 16:07:15 object known: *modules.MemberServiceImpl named memberServiceImpl
2021/08/03 16:07:15 object known: *modules.MemoryRepository
2021/08/03 16:07:15 object known: *modules.FixDiscountPolicy

</code></pre></div></div>

<p>ì°¸ê³ : https://pkg.go.dev/github.com/facebookgo/inject#section-readme</p>
:ET